<div class="flex max-w-6xl mx-auto mt-8 gap-6 text-[#7a6257]">
  <!-- Side Panel -->
  <div class="w-1/3 flex-shrink-0 text-center flex flex-col items-center justify-start relative">
    <button
      class="absolute top-0 left-0 px-4 py-2 bg-[#A38772] text-white rounded-lg hover:bg-[#D9A189] transition"
      routerLink="/shop">
      ← Continue shopping
    </button>

    <ng-container *ngIf="selectedProduct; else placeholder">
      <div class="pt-15 w-full">
        <img [src]="selectedProduct.imageUrl" [alt]="selectedProduct.name"
            class="max-h-72 w-full object-contain rounded-xl shadow-lg mb-2">
        <h2 class="text-lg font-bold text-[#7a6257]">{{ selectedProduct.name }}</h2>

        <div class="flex justify-center pt-2">
          <button
            (click)="addToCart()"
            class="px-6 py-2 bg-[#A38772] text-white rounded-lg hover:bg-[#D9A189] transition disabled:bg-gray-400"
            [disabled]="!form.valid || !form.get('quantity')?.value || (form.get('quantity')?.value ?? 0) <= 0 || isLayerInvalidForBoards">
            Add to Cart
          </button>
        </div>
      </div>
    </ng-container>

    <ng-template #placeholder>
      <div class="h-72 w-full flex items-center justify-center">
        <div class="text-gray-400 italic text-center">Choose product to preview</div>
      </div>
    </ng-template>
  </div>

  <!-- Main Form -->
  <form [formGroup]="form" class="w-2/3 p-6 bg-white rounded-2xl shadow-md space-y-4 border border-[#ECDDCF]">

    <!-- Product Selector -->
    <div class="flex flex-col">
      <label class="mb-1 font-semibold">Choose your product</label>
      <ng-select
          [items]="products"
          bindLabel="name"
          bindValue="id"
          formControlName="type"
          (change)="onProductChange($event)"
          [clearable]="!!selectedProduct">
        <ng-template ng-option-tmp let-item="item">
          <div class="flex items-center">
            <img [src]="item.imageUrl" width="40" height="40" class="mr-2 object-contain" />
            <span>{{ item.name }}</span>
          </div>
        </ng-template>
      </ng-select>
    </div>

    <!-- BOOTS Form -->
    <ng-container *ngIf="selectedProduct?.type === 'Boots'">
      <div class="flex flex-col">
        <label class="mb-1 font-semibold">Width (m)</label>
        <input type="text" formControlName="width" class="p-2 border border-[#ECDDCF] rounded-lg focus:ring-2 focus:ring-[#D9A189]" placeholder="Enter width">
      </div>
      <div class="flex flex-col">
        <label class="mb-1 font-semibold">Height (m)</label>
        <input type="text" formControlName="height" class="p-2 border border-[#ECDDCF] rounded-lg focus:ring-2 focus:ring-[#D9A189]" placeholder="Enter height">
      </div>
      <div class="flex flex-col">
        <label class="mb-1 font-semibold">Quantity</label>
        <input type="text" formControlName="quantity" class="p-2 border border-[#ECDDCF] rounded-lg" placeholder="Enter quantity">
      </div>
    </ng-container>

    <!-- BOARDS Form -->
    <ng-container *ngIf="selectedProduct?.type === 'Boards'">
      <div class="flex gap-4">
        <div class="flex flex-col w-1/2">
          <label class="mb-1 font-semibold">Length (m)</label>
          <input type="text" formControlName="length" class="p-2 border border-[#ECDDCF] rounded-lg focus:ring-2 focus:ring-[#D9A189]" placeholder="Enter length">
        </div>
        <div class="flex flex-col w-1/2">
          <label class="mb-1 font-semibold">Width (m)</label>
          <input type="text" formControlName="width" class="p-2 border border-[#ECDDCF] rounded-lg focus:ring-2 focus:ring-[#D9A189]" placeholder="Enter width">
        </div>
      </div>
      <div class="flex flex-col">
        <label class="mb-1 font-semibold">How many layers of paint?</label>
        <input type="text" formControlName="layers" class="p-2 border border-[#ECDDCF] rounded-lg" placeholder="Enter number of layers">
      </div>
      <div class="flex flex-col">
        <label class="mb-1 font-semibold">Area (m²)</label>
        <input type="number" formControlName="area" class="p-2 border border-[#ECDDCF] bg-[#FAF3EF] rounded-lg" readonly>
      </div>
      <div class="flex flex-col">
        <label class="mb-1 font-semibold">Quantity</label>
        <input type="number" formControlName="quantity" class="p-2 border border-[#ECDDCF] bg-[#FAF3EF] rounded-lg" readonly>
      </div>
    </ng-container>

    <!-- DEFAULT Form -->
    <ng-container *ngIf="selectedProduct && selectedProduct.type !== 'Boots' && selectedProduct.type !== 'Boards'">
      <div class="flex flex-col">
        <label class="mb-1 font-semibold">Length (m)</label>
        <input type="text" formControlName="length" class="p-2 border border-[#ECDDCF] rounded-lg focus:ring-2 focus:ring-[#D9A189]" placeholder="Enter length">
      </div>
      <div class="flex flex-col">
        <label class="mb-1 font-semibold">Width (m)</label>
        <input type="text" formControlName="width" class="p-2 border border-[#ECDDCF] rounded-lg focus:ring-2 focus:ring-[#D9A189]" placeholder="Enter width">
      </div>
      <div class="flex flex-col">
        <label class="mb-1 font-semibold">Area (m²)</label>
        <input type="number" formControlName="area" class="p-2 border border-[#ECDDCF] bg-[#FAF3EF] rounded-lg" readonly>
      </div>
      <div class="flex flex-col">
        <label class="mb-1 font-semibold">Quantity</label>
        <input type="number" formControlName="quantity" class="p-2 border border-[#ECDDCF] bg-[#FAF3EF] rounded-lg" readonly>
      </div>
    </ng-container>

    <!-- Common Fields -->
    <div class="flex flex-col">
      <label class="mb-1 font-semibold">Price per unit</label>
      <input type="number" formControlName="pricePerUnit" class="p-2 border border-[#ECDDCF] bg-[#FAF3EF] rounded-lg" readonly>
    </div>

    <div class="flex flex-col">
      <label class="mb-1 font-semibold">Total Price</label>
      <input type="number" formControlName="totalPrice" class="p-2 border border-[#ECDDCF] bg-[#FAF3EF] rounded-lg" readonly>
    </div>

    <!-- Clear Button -->
    <div class="w-full flex justify-center mt-6">
      <button
        type="button"
        (click)="clearForm()"
        class="px-6 py-2 bg-[#D77474] text-white rounded-lg hover:bg-[#C35151] transition disabled:bg-gray-400"
        [disabled]="!form.valid || (form.get('quantity')?.value ?? 0) <= 0 || isLayerInvalidForBoards">
        Clear Form
      </button>
    </div>
  </form>
</div>
